angular.module("todomvc",["ngRoute"]).config(function($routeProvider){"use strict";$routeProvider.when("/",{controller:"TodoCtrl",templateUrl:"todomvc-index.html"}).when("/:status",{controller:"TodoCtrl",templateUrl:"todomvc-index.html"}).otherwise({redirectTo:"/"})}),angular.module("todomvc").controller("TodoCtrl",function($scope,$routeParams,$filter,todoStorage){"use strict";var todos=$scope.todos=todoStorage.get();$scope.newTodo="",$scope.editedTodo=null,$scope.$watch("todos",function(newValue,oldValue){$scope.remainingCount=$filter("filter")(todos,{completed:!1}).length,$scope.completedCount=todos.length-$scope.remainingCount,$scope.allChecked=!$scope.remainingCount,newValue!==oldValue&&todoStorage.put(todos)},!0),$scope.$on("$routeChangeSuccess",function(){var status=$scope.status=$routeParams.status||"";$scope.statusFilter="active"===status?{completed:!1}:"completed"===status?{completed:!0}:"urgent"===status?{completed:!1,urgent:!0}:null}),$scope.addTodo=function(){var newTodo=$scope.newTodo.trim();newTodo.length&&(todos.push({title:newTodo,completed:!1,urgent:!1}),$scope.newTodo="")},$scope.urgentTodo=function(todo){todo.urgent=!todo.urgent},$scope.editTodo=function(todo){$scope.editedTodo=todo,$scope.originalTodo=angular.extend({},todo)},$scope.doneEditing=function(todo){$scope.editedTodo=null,todo.title=todo.title.trim(),todo.title||$scope.removeTodo(todo)},$scope.revertEditing=function(todo){todos[todos.indexOf(todo)]=$scope.originalTodo,$scope.doneEditing($scope.originalTodo)},$scope.removeTodo=function(todo){todos.splice(todos.indexOf(todo),1)},$scope.clearCompletedTodos=function(){$scope.todos=todos=todos.filter(function(val){return!val.completed})},$scope.markAll=function(completed){todos.forEach(function(todo){todo.completed=!completed})}}),angular.module("todomvc").directive("todoEscape",function(){"use strict";var ESCAPE_KEY=27;return function(scope,elem,attrs){elem.bind("keydown",function(event){event.keyCode===ESCAPE_KEY&&scope.$apply(attrs.todoEscape)})}}),angular.module("todomvc").directive("todoFocus",function($timeout){"use strict";return function(scope,elem,attrs){scope.$watch(attrs.todoFocus,function(newVal){newVal&&$timeout(function(){elem[0].focus()},0,!1)})}}),angular.module("todomvc").factory("todoStorage",function(){"use strict";var STORAGE_ID="todos-angularjs";return{get:function(){return JSON.parse(localStorage.getItem(STORAGE_ID)||"[]")},put:function(todos){localStorage.setItem(STORAGE_ID,JSON.stringify(todos))}}});